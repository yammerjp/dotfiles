#!/usr/bin/env node

const helpMessage = `usage: jnp [options] processing_program_string`;

if (process.stdin.isTTY) {
  console.error(helpMessage);
  process.exit();
}

/*
 * TODO: implements command line options
 *  --help -h
 *  --silent -s
 */

(async () => {
  const buffers = [];
  for await (const chunk of process.stdin) buffers.push(chunk);

  let input, output, stdin, stdout;

  stdin = Buffer.concat(buffers).toString();

  try {
    input = JSON.parse(stdin);
  } catch {
    console.error('failed to parse json from STDIN');
    input = undefined;
  }

  eval("output = input " + process.argv.slice(2).join(' '));

  if (stdout !== undefined) {
    console.log(stdout)
  } else {
    console.log(JSON.stringify(output, null, ' '));
  }
})()
